@(person: util.cprbroker.IPerson, accesslevel: Integer)
@import util.cprbroker.EAddressType;
@import util.Converters;
@import play.Play;
@import play.api.Play.current;
@import java.math.BigInteger; var showparents=0; var showrelations=0;
<div class="modal-header">
    <div class="well">   
        <h4>             
            <span class="glyphicon glyphicon-user"></span>
            Person: @person.registerInformation.cprCitizen.socialSecurityNumber
        </h4> 
        <div>
            @person.postalLabel().map { l =>
                @l <br>
            }
        </div>
        @if(person.tidspunkt != null) {
            <p class="text-right">
                @if(person.tidspunkt.sourceName() != null) {
                    @person.tidspunkt.sourceName,
                }
                @if(person.tidspunkt.tidspunkt != null) {
                    @Messages("person.registrationdate"): @person.tidspunkt.tidspunkt.toString("dd.MM.yy HH:mm:ss") 
                }
            </p>
        }
        <p class="text-right">
        <div id="session" style="display: none;">
            @session.put(person.uuid()+"_uuid", person.uuid())
            @*
                @session.put(person.uuid()+"_cprnum", person.registerInformation.cprCitizen.socialSecurityNumber)
                @session.put(person.uuid()+"_fname", person.firstname)
                @if(person.middelname != null) {
                    @session.put(person.uuid()+"_mname", person.middelname)
                } else {
                    @session.put(person.uuid()+"_mname", "")
                }
                @session.put(person.uuid()+"_lname", person.lastname)
            *@
            @play.api.cache.Cache.set(person.uuid(), person);
        </div>
        @if(session.get("usecart") == "1") {
            @cart(person, person.uuid(), false)
        }
        </p>
    </div>
</div>                         
<div class="modal-body">
    @if(accesslevel > 0) {
        @*
        <ul class="nav nav-pills nav-justified">
            <li class="active"><a href="#generelt" data-toggle="pill">Generelt</a></li>
            <li><a href="#addresse" data-toggle="pill">Adresse</a></li>
            <li><a href="#relationer" data-toggle="pill">Relationer</a></li>    
        </ul>
        *@  
        <ul class="nav nav-pills nav-justified">
            @if(accesslevel > 1) {
                <li class="active"><a href="#generelt@person.uuid()" data-toggle="pill">Generelt</a></li>
                <li><a href="#addresse@person.uuid()" data-toggle="pill">Adresse</a></li>

                @if(person.relationsWithPerson != null) {
                    @if(person.relationsWithPerson.allRelations.length > 0) {


                        <li><a href="#relationer@person.uuid()" data-toggle="pill">Relationer</a></li>
                    }
                }
            } else {
                @if(person.relationsWithPerson != null) {
                    @if(person.relationsWithPerson.allRelations.length > 0) {
                                                                            
                            @{showrelations = 0}

                            @for(r <- person.relationsWithPerson.allRelations) {
                                @if(r.relationshipType.toString() == "Forældremyndighedsindehaver"){
                                    @{showrelations = 1}
                                } 
                            }
    
                            @if(showrelations > 0) {
                                <li class="active"><a href="#" data-toggle="pill">Relationer</a></li>
                            }

                    }
                }
            }       
        </ul>
        <br/>
        <div class="tab-content">
            @if(accesslevel > 1) {
                <div class="tab-pane active" id="generelt@person.uuid()">
                    <div class="row">
                        <div class="col-md-7">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">@Messages("resultat.egenskaber")</h3>
                                </div>
                                <div class="panel-body">
                                    @textfield("person.firstname", person.firstname)
                                    @textfield("person.middelname", person.middelname)
                                    @textfield("person.lastname", person.lastname)
                                    @textfield("person.callname", person.callname)
                                    @textfield("person.nameForAddressing", person.nameForAddressing)
                                    @textfield("person.gender", person.gender)
                                    @if(person.birthdate != null) {
                                        <dl class="dl-horizontal margins-removed">
                                            <dt>@Messages("person.birthdate")</dt>
                                            <dd>@person.birthdate.toString("dd. MMMM yyyy", new Locale("da"))</dd>
                                        </dl>
                                    }
                                    @textfield("person.birthplace", person.nameForAddressing)
                                    @textfield("person.birthRegisteringAuthority", person.birthRegisteringAuthority)
                                </div>
                                <div class="panel-footer"><p class="text-right">@virkning(person.effect, true)</p></div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">@Messages("resultat.registeroplysninger")</h3>
                                </div>
                                <div class="panel-body">
                                @if(person.registerInformation != null) {
                                    @booleanfield(true, "person.registerInformation.cprCitizen.socialSecurityNumberActive", person.registerInformation.cprCitizen.isSocialSecurityNumberValid)
                                    @textfield("person.registerInformation.cprCitizen.personNationalityCode", person.registerInformation.cprCitizen.personNationalityCode)
                                    @booleanfield(true, "person.registerInformation.cprCitizen.isMemberOfTheChurch", person.registerInformation.cprCitizen.isMemberOfTheChurch)
                                    @booleanfield(true, "person.registerInformation.cprCitizen.isResearcherProtected", person.registerInformation.cprCitizen.isResearcherProtected)
                                    @booleanfield(true, "person.registerInformation.cprCitizen.isNameAddressProtected", person.registerInformation.cprCitizen.isNameAddressProtected)
                                    @booleanfield(true, "person.registerInformation.cprCitizen.isPhoneNumberProtected", person.registerInformation.cprCitizen.isPhoneNumberProtected)
                                }
                                </div>
                                <div class="panel-footer"><p class="text-right">@virkning(person.registerInformation.virkning, true)</p></div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">@Messages("resultat.tilstande")</h3>
                                </div>
                                <div class="panel-body">
                                @if(person.tilstand != null) {
                                    @if(person.tilstand.civilStatusKode != null) {
                                        <dl class="dl-horizontal">
                                            <dt>@Messages("person.tilstand.civilStatusKode")</dt>
                                            <dd>@person.tilstand.civilStatusKode</dd>
                                            @if(person.tilstand.civilTilstandsVirkning.fraTidspunkt != null) {
                                                <dd>@virkning(person.tilstand.civilTilstandsVirkning, false)</dd>
                                            }
                                        </dl>
                                    }
                                    @if(person.tilstand.livStatusKode != null) {
                                        <dl class="dl-horizontal">
                                            <dt>@Messages("person.tilstand.livStatusKode")</dt>
                                            <dd>@person.tilstand.livStatusKode</dd>
                                            @if(person.tilstand.livTilstandsVirkning.fraTidspunkt != null) {
                                                <dd>@virkning(person.tilstand.livTilstandsVirkning, false)</dd>
                                            }
                                        </dl>
                                    }
                                }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="addresse@person.uuid()">
                    <div class="row">
                        <div class="col-md-12">
                            @if(person.address != null) {
                                @if(person.address.addressType == EAddressType.Danish) {
                                    @danishaddress(person)
                                }
                                @if(person.address.addressType == EAddressType.Greenlandic) {
                                    @greenlandicaddress(person)
                                }
                                @if(person.address.addressType == EAddressType.World) {
                                    @worldaddress(person)
                                }
                            }
                        </div>
                    </div>
                </div>  
            }
            @if(person.relationsWithPerson != null) {
                @if(person.relationsWithPerson.allRelations.length > 0) {
                    @if(accesslevel > 1) {
                    <div class="tab-pane" id="relationer@person.uuid()">
                    }
                        <div class="row">
                            <div class="col-md-12">
                                <br/>
                                @if(person.relationsWithPerson != null) {
                                    @for(r <- person.relationsWithPerson.allRelations) {
                                        @if(accesslevel > 1) {
                                            @relation(r, person)
                                        } else {
                                            @if(r.relationshipType.toString() == "Forældremyndighedsindehaver"){
                                                @relation(r, person)
                                            }
                                        }
                                        
                                    }
                                }
                            </div>
                        </div>
                    @if(accesslevel > 1) {
                    </div>
                    }
                }
            }
        </div>
    }
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>